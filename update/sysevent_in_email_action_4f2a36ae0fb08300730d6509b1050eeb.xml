<?xml version="1.0" encoding="UTF-8"?>
<record_update sys_domain="global" table="sysevent_in_email_action">
    <sysevent_in_email_action action="INSERT_OR_UPDATE">
        <action>record_action</action>
        <active>true</active>
        <assignment_operator/>
        <condition_script/>
        <description/>
        <event_name>email.read</event_name>
        <filter_condition table="sys_email">recipientsINlhuo_helpdesk@loewshotels.com^EQ<item endquery="false" field="recipients" goto="false" newquery="false" operator="IN" or="false" value="lhuo_helpdesk@loewshotels.com"/>
            <item endquery="true" field="" goto="false" newquery="false" operator="=" or="false" value=""/>
        </filter_condition>
        <from/>
        <name>Update Incident (BP)</name>
        <order>100</order>
        <reply_email/>
        <required_roles/>
        <script><![CDATA[gs.include('validators');

var skipmsg = false;

if (email.subject != undefined) {
  var subject = email.subject;

if ((subject.toLowerCase().indexOf("out of the office") > -1) || (subject.toLowerCase().indexOf("in my absence") > -1))
   skipmsg = true;
if ((subject.toLowerCase().indexOf("Je suis absent(e)") > -1))
   skipmsg = true;
if (subject.toLowerCase().indexOf("your message has been received by loews hotels reservations center") > -1)
   skipmsg = true;
if ((email.from.toString().toLowerCase().indexOf('@loewshotels.com') == -1) && 
   (email.from.toString().toLowerCase().indexOf('@annapoliswestkt.com') == -1) && 
   (email.from.toString().toLowerCase().indexOf('@thing5.com') == -1) && 
   (email.from.toString().toLowerCase().indexOf('@universalorlando.com') == -1) &&
   (email.from.toString().toLowerCase().indexOf('@hot-sos.net') == -1) &&
   (email.from.toString().toLowerCase().indexOf('@bwpmlp.com') == -1) &&
   (email.from.toString().toLowerCase().indexOf('@highmountholdco.com') == -1) &&
   (email.from.toString().toLowerCase().indexOf('@mlbaconsultants.com') == -1) &&
   (email.from.toString().toLowerCase().indexOf('@walnuthillmedia.com') == -1) &&
   (email.from.toString().toLowerCase().indexOf('@tfmg.net') == -1) &&
   (email.from.toString().toLowerCase().indexOf('@loews.com') == -1)) {
   skipmsg = true;
}

}

if (!skipmsg) {

if (current.getTableName() == "incident") {
   current.comments = "reply from: " + email.origemail + "\n\n" + email.body_text;
   
   //if (email.subject.toLowerCase().indexOf("please reopen") >= 0) {
      //current.state = "2";
      //current.work_notes = "The caller did not feel that this issue was resolved";
   //}
   
   //if (email.body.assign != undefined) current.assigned_to = email.body.assign;
   
   //if (email.body.priority != undefined && isNumeric(email.body.priority)) current.priority = email.body.priority;
   
   //if (email.body.category != undefined) current.category = email.body.category;
   
   //if (email.body.short_description != undefined) current.short_description = email.body.short_description;
   
   current.update();
}

}]]></script>
        <stop_processing>false</stop_processing>
        <sys_class_name>sysevent_in_email_action</sys_class_name>
        <sys_created_by>dgarber</sys_created_by>
        <sys_created_on>2017-08-28 16:59:10</sys_created_on>
        <sys_customer_update>true</sys_customer_update>
        <sys_domain>global</sys_domain>
        <sys_id>4f2a36ae0fb08300730d6509b1050eeb</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>Update Incident (BP)</sys_name>
        <sys_overrides/>
        <sys_package display_value="Loews Hotels Opera Configuration Form" source="x_lohar_opera_conf">6c8ed5dd0f323a006833a218b1050e9a</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Loews Hotels Opera Configuration Form">6c8ed5dd0f323a006833a218b1050e9a</sys_scope>
        <sys_update_name>sysevent_in_email_action_4f2a36ae0fb08300730d6509b1050eeb</sys_update_name>
        <sys_updated_by>dgarber</sys_updated_by>
        <sys_updated_on>2017-08-28 17:00:02</sys_updated_on>
        <table>x_lohar_orlando_in_orlando_incident</table>
        <template/>
        <type>reply</type>
    </sysevent_in_email_action>
</record_update>
